<!DOCTYPE html>
<html>
<head>
    <title>Cat API Viewer</title>
    <style>
        body { 
            margin: 0; 
            padding: 20px; 
            background: #f5f5f5; 
            font-family: Arial; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            text-align: center;
        }
        canvas { 
            border: 2px solid #333; 
            background: white; 
            cursor: pointer;
            margin: 10px 0;
        }
        .info { 
            margin: 10px 0; 
            font-size: 18px;
            max-width: 800px;
        }
        h1 { 
            color: #333; 
            margin-bottom: 5px;
        }
        .loading { 
            color: #0079f1; 
            font-weight: bold; 
        }
        .error { 
            color: #e6291d; 
            font-weight: bold; 
        }
        .success { 
            color: #00a800; 
            font-weight: bold; 
        }
    </style>
</head>
<body>
    <h1>üê± Random Cat API Viewer</h1>
    <div class="info">Click "NEW CAT" to fetch random cat images from The Cat API!</div>
    <div id="status" class="info">üîÑ Ready to load cats...</div>
    <canvas id="gameCanvas" width="800" height="450"></canvas>
    <div class="info" style="font-size: 14px; color: #666;">
        Powered by <a href="https://cataas.com/" target="_blank">The Cat as a Service API</a>
    </div>
    
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const statusDiv = document.getElementById('status');
        
        let currentCatImage = null;
        let isLoading = false;
        
        const buttonWidth = 150;
        const buttonHeight = 50;
        const catButton = { x: 325, y: 350, width: buttonWidth, height: buttonHeight };
        
        // Function to fetch random cat image
        async function fetchRandomCat() {
            if (isLoading) return;
            
            isLoading = true;
            statusDiv.textContent = "üîÑ Contacting cat server...";
            statusDiv.className = 'info loading';
            draw();
            
            try {
                // Using CATAAS API - no API key needed, works with CORS
                const timestamp = new Date().getTime(); // Avoid cache
                const response = await fetch(`https://cataas.com/cat?timestamp=${timestamp}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                // Convert response to blob (image data)
                const blob = await response.blob();
                const imageUrl = URL.createObjectURL(blob);
                
                statusDiv.textContent = "‚úÖ Downloading cat...";
                
                // Load the cat image
                const img = new Image();
                img.onload = function() {
                    currentCatImage = img;
                    statusDiv.textContent = "üò∫ Cat loaded successfully!";
                    statusDiv.className = 'info success';
                    isLoading = false;
                    draw();
                    // Clean up the object URL after use
                    setTimeout(() => URL.revokeObjectURL(imageUrl), 1000);
                };
                img.onerror = function() {
                    statusDiv.textContent = "‚ùå Failed to load cat image";
                    statusDiv.className = 'info error';
                    isLoading = false;
                    draw();
                };
                img.src = imageUrl;
                
            } catch (error) {
                console.error('Error fetching cat:', error);
                statusDiv.textContent = "‚ùå Network error: " + error.message;
                statusDiv.className = 'info error';
                isLoading = false;
                draw();
            }
        }
        
        function draw() {
            // Clear canvas
            ctx.fillStyle = '#f5f5f5';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw cat image or placeholder
            if (currentCatImage) {
                try {
                    // Calculate dimensions to fit while maintaining aspect ratio
                    const maxWidth = 400;
                    const maxHeight = 300;
                    let { width, height } = currentCatImage;
                    
                    // Calculate scaling to fit within max dimensions
                    const scale = Math.min(maxWidth / width, maxHeight / height, 1);
                    width *= scale;
                    height *= scale;
                    
                    const x = 400 - width / 2;
                    const y = 225 - height / 2;
                    
                    ctx.drawImage(currentCatImage, x, y, width, height);
                    
                    // Draw image border
                    ctx.strokeStyle = '#333';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(x, y, width, height);
                    
                } catch (e) {
                    // If image drawing fails, show error
                    ctx.fillStyle = '#ffcccc';
                    ctx.fillRect(250, 125, 300, 200);
                    ctx.fillStyle = '#cc0000';
                    ctx.font = '16px Arial';
                    ctx.fillText('Error displaying image', 320, 235);
                }
            } else {
                // Draw placeholder
                ctx.fillStyle = '#e0e0e0';
                ctx.fillRect(250, 125, 300, 200);
                ctx.fillStyle = '#666666';
                ctx.font = '20px Arial';
                ctx.fillText('Click "NEW CAT" to load a cat!', 280, 235);
                
                // Draw placeholder border
                ctx.strokeStyle = '#999';
                ctx.lineWidth = 1;
                ctx.strokeRect(250, 125, 300, 200);
            }
            
            // Draw button
            ctx.fillStyle = isLoading ? '#888888' : '#505050';
            ctx.fillRect(catButton.x, catButton.y, catButton.width, catButton.height);
            
            // Button border
            ctx.strokeStyle = isLoading ? '#666' : '#333';
            ctx.lineWidth = 2;
            ctx.strokeRect(catButton.x, catButton.y, catButton.width, catButton.height);
            
            // Button text
            ctx.fillStyle = 'white';
            ctx.font = 'bold 20px Arial';
            const buttonText = isLoading ? 'LOADING...' : 'üê± NEW CAT';
            const textWidth = ctx.measureText(buttonText).width;
            ctx.fillText(buttonText, catButton.x + (buttonWidth - textWidth) / 2, catButton.y + 32);
            
            // Draw title
            ctx.fillStyle = '#333';
            ctx.font = 'bold 28px Arial';
            ctx.fillText('Random Cat API Viewer', 240, 60);
            
            ctx.font = '18px Arial';
            ctx.fillStyle = '#666';
            ctx.fillText('Powered by The Cat API', 310, 90);
        }
        
        function isPointInRect(x, y, rect) {
            return x >= rect.x && x <= rect.x + rect.width &&
                   y >= rect.y && y <= rect.y + rect.height;
        }
        
        canvas.addEventListener('click', (e) => {
            if (isLoading) return;
            
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            
            if (isPointInRect(mouseX, mouseY, catButton)) {
                fetchRandomCat();
            }
        });
        
        // Add hover effects
        canvas.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            
            if (isPointInRect(mouseX, mouseY, catButton) && !isLoading) {
                canvas.style.cursor = 'pointer';
            } else {
                canvas.style.cursor = 'default';
            }
        });
        
        // Initial draw
        draw();
        
        // Load first cat automatically after a delay
        setTimeout(() => {
            statusDiv.textContent = "üëÜ Click 'NEW CAT' to load your first cat!";
            draw();
        }, 1000);
    </script>
</body>
</html>